{% extends "base.html" %}

{% block title %}API 사용 가이드 - My Blog{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <h2 class="mb-4">API 사용 가이드</h2>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">1. API 키 발급</h5></div>
            <div class="card-body">
                <ol>
                    <li><a href="{% url 'blog:google_login_check' %}">Google 로그인</a>을 합니다.</li>
                    <li>상단 메뉴에서 <strong>API 키</strong>를 클릭하거나 <a href="{% url 'blog:api_key_list' %}">여기</a>로 이동합니다.</li>
                    <li>키 이름을 입력하고, 권한을 선택한 후 <strong>발급</strong> 버튼을 누릅니다.</li>
                    <li>발급된 키는 <strong>한 번만</strong> 표시됩니다. 반드시 안전한 곳에 복사해두세요.</li>
                </ol>
                <div class="alert alert-info mb-0">
                    <strong>권한 안내:</strong>
                    <ul class="mb-0 mt-1">
                        <li><strong>Read</strong> &mdash; 글 목록/상세 조회</li>
                        <li><strong>Write</strong> &mdash; Read 권한 + 댓글 작성/삭제</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">2. API 인증 방법</h5></div>
            <div class="card-body">
                <p>모든 API 요청에 <code>Authorization</code> 헤더를 포함합니다:</p>
                <pre class="bg-dark text-light p-3 rounded"><code>Authorization: Key YOUR_API_KEY</code></pre>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">3. 글 목록 조회</h5></div>
            <div class="card-body">
                <p><code>GET /api/posts/</code> <span class="badge bg-info">read</span></p>
                <h6>파라미터 (선택)</h6>
                <table class="table table-sm">
                    <thead><tr><th>이름</th><th>설명</th></tr></thead>
                    <tbody>
                        <tr><td><code>tag</code></td><td>특정 태그로 필터링</td></tr>
                        <tr><td><code>page</code></td><td>페이지 번호 (기본: 1)</td></tr>
                        <tr><td><code>per_page</code></td><td>페이지당 글 수 (기본: 20, 최대: 100)</td></tr>
                    </tbody>
                </table>
                <h6>예시</h6>
                <pre class="bg-dark text-light p-3 rounded"><code>curl -H "Authorization: Key YOUR_API_KEY" \
  {{ request.scheme }}://{{ request.get_host }}/api/posts/?tag=python</code></pre>
                <h6>응답</h6>
                <pre class="bg-light p-3 rounded"><code>{
  "posts": [
    {
      "title": "글 제목",
      "slug": "글-제목",
      "date": "2025-01-01T00:00:00",
      "summary": "요약",
      "tags": ["python"]
    }
  ],
  "pagination": {
    "page": 1,
    "per_page": 20,
    "total": 1,
    "total_pages": 1
  }
}</code></pre>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">4. 글 상세 조회</h5></div>
            <div class="card-body">
                <p><code>GET /api/posts/{slug}/</code> <span class="badge bg-info">read</span></p>
                <pre class="bg-dark text-light p-3 rounded"><code>curl -H "Authorization: Key YOUR_API_KEY" \
  {{ request.scheme }}://{{ request.get_host }}/api/posts/my-post/</code></pre>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">5. 댓글 작성</h5></div>
            <div class="card-body">
                <p><code>POST /api/posts/{slug}/comments/</code> <span class="badge bg-warning text-dark">write</span></p>
                <h6>요청 본문 (JSON)</h6>
                <pre class="bg-light p-3 rounded"><code>{"content": "댓글 내용"}</code></pre>
                <h6>예시</h6>
                <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST \
  -H "Authorization: Key YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"content":"좋은 글이네요!"}' \
  {{ request.scheme }}://{{ request.get_host }}/api/posts/my-post/comments/</code></pre>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">6. 댓글 삭제</h5></div>
            <div class="card-body">
                <p><code>DELETE /api/comments/{id}/</code> <span class="badge bg-warning text-dark">write</span></p>
                <p class="text-muted">본인이 작성한 댓글만 삭제할 수 있습니다.</p>
                <pre class="bg-dark text-light p-3 rounded"><code>curl -X DELETE \
  -H "Authorization: Key YOUR_API_KEY" \
  {{ request.scheme }}://{{ request.get_host }}/api/comments/42/</code></pre>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">에러 응답</h5></div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead><tr><th>상태 코드</th><th>의미</th></tr></thead>
                    <tbody>
                        <tr><td><code>400</code></td><td>잘못된 요청 (파라미터 오류 등)</td></tr>
                        <tr><td><code>401</code></td><td>인증 실패 (키 없음/잘못된 키)</td></tr>
                        <tr><td><code>403</code></td><td>권한 부족/키 만료/비활성</td></tr>
                        <tr><td><code>404</code></td><td>리소스를 찾을 수 없음</td></tr>
                        <tr><td><code>405</code></td><td>허용되지 않는 HTTP 메소드</td></tr>
                    </tbody>
                </table>
                <p>모든 에러 응답은 다음 형식입니다:</p>
                <pre class="bg-light p-3 rounded"><code>{"error": "에러 메시지"}</code></pre>
            </div>
        </div>

        {% if user.is_staff %}
        <div class="text-center">
            <a href="{% url 'blog:api_admin_guide' %}" class="btn btn-outline-secondary">관리자 API 가이드 &rarr;</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
