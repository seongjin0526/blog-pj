{% extends "base.html" %}

{% block title %}관리자 API 가이드 - My Blog{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <h2 class="mb-4">관리자 API 가이드</h2>
        <p class="text-muted mb-4">이 페이지는 블로그 관리자(staff)만 볼 수 있습니다.</p>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">Admin API 키 발급</h5></div>
            <div class="card-body">
                <ol>
                    <li><a href="{% url 'blog:api_key_list' %}">API 키 관리</a> 페이지로 이동합니다.</li>
                    <li>키 이름을 입력하고 권한을 <strong>Admin (전체)</strong>으로 선택합니다.</li>
                    <li>Admin 권한은 staff 계정만 발급할 수 있습니다.</li>
                    <li>보안을 위해 만료일을 설정하는 것을 권장합니다.</li>
                </ol>
                <div class="alert alert-warning mb-0">
                    <strong>주의:</strong> Admin 키는 파일 업로드(글 작성) 권한을 포함합니다. 유출되지 않도록 주의하세요.
                    키가 유출된 경우 즉시 <a href="{% url 'blog:api_key_list' %}">API 키 관리</a>에서 비활성화하세요.
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">파일 업로드 API</h5></div>
            <div class="card-body">
                <p><code>POST /api/upload-post/</code> <span class="badge bg-danger">admin</span></p>
                <p>Markdown(.md) 또는 ZIP(.zip) 파일을 업로드하여 새 게시글을 생성합니다.</p>

                <h6>Markdown 파일 업로드</h6>
                <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST \
  -H "Authorization: Key YOUR_ADMIN_KEY" \
  -F "file=@my-post.md" \
  {{ request.scheme }}://{{ request.get_host }}/api/upload-post/</code></pre>

                <h6>ZIP 파일 업로드 (이미지 포함)</h6>
                <pre class="bg-dark text-light p-3 rounded"><code># ZIP 구조: post.md + images/photo.png
curl -X POST \
  -H "Authorization: Key YOUR_ADMIN_KEY" \
  -F "file=@my-post.zip" \
  {{ request.scheme }}://{{ request.get_host }}/api/upload-post/</code></pre>

                <h6>응답</h6>
                <pre class="bg-light p-3 rounded"><code>{"slug": "my-post", "url": "/post/my-post/"}</code></pre>

                <h6>제한사항</h6>
                <ul>
                    <li><code>.md</code> 파일: 최대 2MB</li>
                    <li><code>.zip</code> 파일: 최대 50MB, 압축 해제 시 100MB, 항목 100개 이내</li>
                    <li>ZIP 내 <code>.md</code> 파일은 정확히 1개여야 합니다</li>
                    <li>ZIP 내 이미지는 자동으로 추출되어 경로가 치환됩니다</li>
                </ul>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">Markdown 파일 형식</h5></div>
            <div class="card-body">
                <p>YAML frontmatter를 포함한 Markdown 파일을 권장합니다:</p>
                <pre class="bg-light p-3 rounded"><code>---
title: 글 제목
date: 2025-01-15 14:30:00
summary: 글 요약
tags: [python, django, tutorial]
---

# 본문 시작

여기에 글 내용을 작성합니다.

![이미지](images/screenshot.png)</code></pre>
                <p class="text-muted mt-2">frontmatter가 없으면 파일명이 제목으로, 업로드 시간이 날짜로 자동 설정됩니다.</p>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">자동화 스크립트 예시</h5></div>
            <div class="card-body">
                <h6>Python으로 글 업로드</h6>
                <pre class="bg-dark text-light p-3 rounded"><code>import requests

API_KEY = "YOUR_ADMIN_KEY"
URL = "{{ request.scheme }}://{{ request.get_host }}/api/upload-post/"

with open("my-post.md", "rb") as f:
    resp = requests.post(
        URL,
        headers={"Authorization": f"Key {API_KEY}"},
        files={"file": ("my-post.md", f)},
    )
    print(resp.json())</code></pre>

                <h6>Shell 스크립트: 디렉토리 내 모든 .md 파일 업로드</h6>
                <pre class="bg-dark text-light p-3 rounded"><code>#!/bin/bash
API_KEY="YOUR_ADMIN_KEY"
HOST="{{ request.scheme }}://{{ request.get_host }}"

for f in posts/*.md; do
  echo "Uploading: $f"
  curl -s -X POST \
    -H "Authorization: Key $API_KEY" \
    -F "file=@$f" \
    "$HOST/api/upload-post/"
  echo
done</code></pre>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header"><h5 class="mb-0">권한 체계</h5></div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr><th>Scope</th><th>조회</th><th>댓글</th><th>업로드</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><span class="badge bg-info">Read</span></td><td>O</td><td>X</td><td>X</td></tr>
                        <tr><td><span class="badge bg-warning text-dark">Write</span></td><td>O</td><td>O</td><td>X</td></tr>
                        <tr><td><span class="badge bg-danger">Admin</span></td><td>O</td><td>O</td><td>O</td></tr>
                    </tbody>
                </table>
                <p class="text-muted mb-0">상위 권한은 하위 권한의 모든 기능을 포함합니다.</p>
            </div>
        </div>

        <div class="text-center">
            <a href="{% url 'blog:api_guide' %}" class="btn btn-outline-secondary">&larr; 일반 API 가이드</a>
        </div>
    </div>
</div>
{% endblock %}
